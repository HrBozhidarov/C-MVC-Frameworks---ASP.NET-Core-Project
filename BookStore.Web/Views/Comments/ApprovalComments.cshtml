@{
    ViewData["Title"] = "ApprovalComments";
}

<h1 class="text-center my-3">Approve Comments</h1>

<div id="appendComment">
    <div id="aprovalComments">
        <div id="progress" class="text-center" style="display:none">
            <img src="~/lib/slick/ajax-loader.gif" />
        </div>
    </div>
</div>

<script type="text/javascript">
    var pageSize = 1;
    var pageIndex = 0;
    var maxPage = 0;
    var scrolling = true;
    var initial = false;

    getNumberOfComments();
    setTimeout(getData(), 300);

    $(document).ready(function () {

        $(window).scroll(function () {

            var scrollTop = $(document).scrollTop();
            var windowHeight = $(window).height();
            var bodyHeight = $(document).height() - windowHeight;
            var scrollPercentage = (scrollTop / bodyHeight);

            // if the scroll is more than 90% from the top, load more content.
            if (scrollPercentage > 0.8 && pageIndex <= maxPage && !scrolling) {
                getData();

                scrolling = true;
            }
        });
    });

    function getData() {
        $.ajax({
            type: 'POST',
            url: '/comments/GetDataNotApprovalComments',
            data: { "pageindex": pageIndex, "pagesize": pageSize },
            dataType: 'html',
            success: function (data) {
                if (data.trim() != '') {
                    $("#aprovalComments").append(data);
                    scrolling = false;
                    initial = true;
                    pageIndex++;
                }
                else if (!initial) {
                    $("#aprovalComments").append('<div class="normal-bold text-center">No Comments for Approve yet.</div> ');
                    initial = true;
                }
                else {
                    $("#aprovalComments").append('<div class="text-center">No more comments for approval.</div> <hr class= "hr-bg-color-second"/> ');
                }
            },
            beforeSend: function () {
                $("#progress").show();
            },
            complete: function () {
                $("#progress").hide();
            },
            error: function () {
                alert("Error while retrieving data!");
            }
        });
    }

    function getNumberOfComments() {
        $.ajax({
            type: 'GET',
            url: '/api/ApiComments/countNotAprovel',
            data: {},
            dataType: 'text',
            success: function (data) {
                maxPage = Math.floor(parseInt(data) / pageSize);
            },
            error: function () {
                alert("Error while retrieving data!");
            }
        })
    }
</script>

